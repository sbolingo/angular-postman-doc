var postman=angular.module("angularPostmanDoc",[]);postman.factory("Postman",["$q","$http","$sce",function(a,b,c){function d(){q=void 0,r="",s=[],t=[]}function e(c){d();var e=function(a,e){b.get(c).then(function(b){p=c,d(),q=angular.copy(b.data),a(b)},function(a){e(a)})};return a(e,10)}function f(){return p}function g(a){d(),q=angular.copy(a)}function h(){return q}function i(){return c.trustAsHtml(r)}function j(a,b){var c=null;return a.forEach(function(a){a.id==b&&(c=a)}),c}function k(a){if(!angular.isString(a)||""==a.trim())return"";var b=a.charAt(0).toLowerCase();return b+a.substr(1).replace(/[A-Z ]/g,function(a){return""==a.trim()?"-":a.toLowerCase()})}function l(a,b){return k(a)+"-m-"+k(b)}function m(a,b){var d=angular.fromJson(q),e=d.folders,f=d.requests,g=function(a){return a.replace(/[\{\}\[\]\,\"\'\:]/g,function(a){return"<span class='p'>"+a+"</span>"}).replace(/true|false/gi,function(a){return"<span class='k'>"+a+"</span>"}).replace(/([^a-z])([0-9])(?=[^a-z])|null/gi,function(a){return"<span class='mi'>"+a+"</span>"})},h=function(c,d){var e="<table ";if(angular.isString(d)&&""!=d.trim()&&(e+='id="'+l(d,c.name)+'" '),e+='class="novice novice-postman table-request table table-bordered"><tbody>',e+='<tr><td class="novice novice-postman name" colspan="2">',a&&(e+=d+": "),e+=c.name+"</td></tr>",c.description)if(b){var f=new showdown.Converter;f.setOption("tables",!0),e+='<tr><td class="table-responsive novice novice-postman description" colspan="2">'+f.makeHtml(c.description)+"</td></tr>"}else e+='<tr><td class="novice novice-postman description" colspan="2">'+c.description+"</td></tr>";if(e+='<tr><td>Headers:</td><td class="novice novice-postman headers">'+c.headers+"</td></tr>",e+='<tr><td>Method:</td><td class="novice novice-postman method"><span class="method '+c.method.toLowerCase()+'">'+c.method+"</span></td></tr>",e+='<tr><td>URL:</td><td class="novice novice-postman url">'+c.url+"</td></tr>","params"===c.dataMode&&c.data&&c.data instanceof Array&&c.data.length>0){e+="<tr><td>Params:</td><td>";var h='<table class="novice novice-postman params">';c.data.forEach(function(a){h+="<tr><td>Key:</td><td>"+a.key+"</td></tr>",h+="<tr><td>Value:</td><td>"+a.type+"</td></tr>",h+="<tr><td>Type:</td><td>"+a.value+"</td></tr>"}),h+="</table>",e+=h,e+="</td></tr>"}else{var i=c.data;if(c.headers&&c.headers.toLowerCase().indexOf("content-type: application/json")!=-1){try{i=angular.isString(c.rawModeData)&&""!=c.rawModeData.trim()?c.rawModeData:i,i=angular.isArray(i)&&i.length>0||angular.isString(i)&&""!=i.trim()?'<pre class="novice novice-postman raw">'+g(angular.toJson(angular.fromJson(i),2))+"</pre>":"none"}catch(a){console.error("Unable to prettify JSON: "+a)}e+="<tr><td>Data:</td><td>"+i+"</td></tr>"}}return e+="</tbody></table>"};return r='<div class="novice novice-postman">',r+='<h1 class="title">'+d.name+"</h1>",e&&e.length>0?e.forEach(function(a){r+='<h2 id="'+k(a.name)+'" class="novice novice-postman folder">'+a.name+"</h2>";var b=a.name;a.order.forEach(function(a){var c=j(f,a);c&&(r+=h(c,b))})}):f.forEach(function(a){r+=h(a)}),r+="</div>",c.trustAsHtml(r)}function n(a){if(!a&&s.length>0)return s;var b=a?a:angular.fromJson(q),c=b.folders,d=a?o(a):o();return c&&c.length>0&&(c.forEach(function(a){a.order.forEach(function(b){var c=j(d,b);c&&(angular.isArray(a.requests)||(a.requests=[]),a.requests.push(c))})}),a||(s=angular.copy(c))),c}function o(a){if(!a&&t.length>0)return t;var b=a?a:angular.fromJson(q),c=b.requests;return a||(t=angular.copy(c)),c}var p,q,r="",s=[],t=[];return{getJsonUrl:f,setCollection:g,getCollection:h,getHTMLDoc:i,getFolders:n,getRequests:o,getRequestWithId:j,toUnderscore:k,toUnderscoreConcat:l,fromUrl:e,buildHTMLDoc:m}}]),postman.directive("postmanCollection",["Postman","$compile","$http","$templateCache","$timeout","$anchorScroll",function(a,b,c,d,e,f){var g={url:"collectionUrl",template:"templateUrl",showdownjs:"markdownDescription",repeatFoldername:"repeatFoldername",noCache:"noCache"};return{restrict:"A",scope:{collectionUrl:"@collectionUrl",templateUrl:"@templateUrl",markdownDescription:"=markdownDescription",repeatFoldername:"=repeatFoldername",noCache:"=noCache"},link:function(h,i,j){var k=function(){e(function(){f()},5)},l=function(a){i.append(a),b(i.contents())(h),k()},m=function(a){h.htmlDoc=a,l(angular.element('<div ng-bind-html="htmlDoc"></div>'))},n=function(){console.log("render cache"),l(d.get(h.templateUrl))};if(h.postmanCollection==a.getJsonUrl()&&angular.isUndefined(h.templateUrl)&&""!=a.getHTMLDoc())return void m(a.getHTMLDoc());var o=!1;angular.isUndefined(h.markdownDescription)?angular.isString(j[g.showdownjs])&&""===j[g.showdownjs]&&(o=!0):o=h.markdownDescription;var p=!1;angular.isUndefined(h.repeatFoldername)?angular.isString(j[g.repeatFoldername])&&""===j[g.repeatFoldername]&&(p=!0):p=h.repeatFoldername;var q=!1;angular.isUndefined(h.noCache)?angular.isString(j[g.noCache])&&""===j[g.noCache]&&(q=!0):q=h.noCache,a.fromUrl(h.collectionUrl).then(function(b){angular.isUndefined(h.templateUrl)?m(a.buildHTMLDoc(p,o)):(h.collection=a.getCollection(),h.folders=a.getFolders(),h.requests=a.getRequests(),h.showMe={},h.folders.forEach(function(b){h.showMe[b.name]=!1,b.uname=a.toUnderscore(b.name),b.requests.forEach(function(c){c.uname=a.toUnderscoreConcat(b.uname,c.name)})}),q?c.get(h.templateUrl).then(function(a){l(a.data)}):angular.isUndefined(d.get(h.templateUrl))?c.get(h.templateUrl).then(function(a){d.put(h.templateUrl,a.data),n()}):n())})}}}]),postman.directive("postmanFolders",["Postman","$compile","$http","$q","$templateCache","$timeout","$anchorScroll","$sce","$location",function(a,b,c,d,e,f,g,h,i){var j={url:"collectionUrl",ref:"ref",noCache:"noCache"},k=angular.copy(a);return{restrict:"A",scope:{collectionUrl:"@collectionUrl",ref:"@ref",noCache:"=noCache"},link:function(a,e,f){var g,h=function(c){e.append(c),a.waitTillItsDone=!1,b(e.contents())(a),a.waitTillItsDone=!0},i=function(a,b){c.get(f[j.url]).then(function(b){g=angular.copy(b.data),a(b)},function(a){b(a)})};d(i,10).then(function(){var b=angular.fromJson(g),c=k.getFolders(b);if(c&&c.length>0){a.showMe={},c.forEach(function(b){a.showMe[b.name]=!1,b.uname=k.toUnderscore(b.name),b.requests.forEach(function(a){a.uname=k.toUnderscoreConcat(b.uname,a.name)})}),a.folders=c,a.toggleFolder=function(b){a.showMe[b]=!a.showMe[b]},a.getMethodPetName=function(a){var b=a;if(angular.isString(a))switch(a){case"DELETE":b="DEL";break;case"delete":b="del"}return b};var d='<div class="postman-collection-folders">';d+='<ul class="postman-folders" style="list-style-type: none; width: 100%;">',d+='<li class="postman-folder" ng-repeat="folder in folders" data-text="folder.name">',d+='<div ng-class="{\'open\': showMe[folder.name]}" data-ng-click="toggleFolder(folder.name)" title="{{folder.name}}" ',d+='style="cursor: pointer; width: 100%; display: block; float: none;">',d+="<i ng-class=\"showMe[folder.name] ? 'icon-folder-open' : 'icon-folder'\"></i> <span class=\"postman-folder-name\">{{folder.name}}</span>",d+="</div>",d+='<ul class="postman-requests" data-ng-show="showMe[folder.name]" style="list-style-type: none; width: 100%;">',d+='<li class="postman-request" ng-repeat="r in folder.requests">',d+='<div ng-class="r.method.toLowerCase()" class="method" style="display: block; float: none;"><span>{{getMethodPetName(r.method)}}</span></div>',d+='<div class="postman-request-name" style="display: block; float: none;">';var e=angular.isUndefined(a.ref)?"":a.ref;d+='<a data-ng-href="'+e+'#{{r.uname}}">{{r.name}}</a>',d+="</div>",d+="</li>",d+="</ul>",d+="</li></ul></div>",h(d)}})}}}]);