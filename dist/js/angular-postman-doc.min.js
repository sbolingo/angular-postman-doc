var postman=angular.module("angularPostmanDoc",[]);postman.factory("PostmanDoc",["$q","$http","$sce",function(a,b,c){function d(){if(angular.isUndefined(a)){var a=new showdown.Converter;a.setOption("tables",!0)}return a}function e(){r=void 0,s="",t=[],u=[]}function f(c){e();var d=function(a,d){b.get(c).then(function(b){q=c,e(),r=angular.copy(b.data),a(b)},function(a){d(a)})};return a(d,10)}function g(){return q}function h(a){e(),r=angular.copy(a)}function i(){return r}function j(a){return a?c.trustAsHtml(s):s}function k(a,b){var c=null;return a.forEach(function(a){a.id==b&&(c=a)}),c}function l(a){if(!angular.isString(a)||""==a.trim())return"";var b=a.charAt(0).toLowerCase();return b+a.substr(1).replace(/[A-Z ]/g,function(a){return""==a.trim()?"-":a.toLowerCase()})}function m(a,b){return l(a)+"-m-"+l(b)}function n(a,b,e){var f=angular.fromJson(r),g=f.folders,h=f.requests;angular.isObject(a)&&(e=a.safeHtml,b=a.mdToHtmlDescription,a=a.repeatFoldername);var i=function(a){return a.replace(/[\{\}\[\]\,\"\'\:]/g,function(a){return"<span class='p'>"+a+"</span>"}).replace(/true|false/gi,function(a){return"<span class='k'>"+a+"</span>"}).replace(/([^a-z])([0-9])(?=[^a-z])|null/gi,function(a){return"<span class='mi'>"+a+"</span>"})},j=function(c,e){var f="<table ";if(angular.isString(e)&&""!=e.trim()&&(f+='id="'+m(e,c.name)+'" '),f+='class="novice novice-postman table-request table table-bordered"><tbody>',f+='<tr><td class="novice novice-postman name" colspan="2">',a&&(f+=e+": "),f+=c.name+"</td></tr>",c.description&&(f+=b?'<tr><td class="table-responsive novice novice-postman description" colspan="2">'+d().makeHtml(c.description)+"</td></tr>":'<tr><td class="novice novice-postman description" colspan="2">'+c.description+"</td></tr>"),f+='<tr><td>Headers:</td><td class="novice novice-postman headers">'+c.headers+"</td></tr>",f+='<tr><td>Method:</td><td class="novice novice-postman method"><span class="method '+c.method.toLowerCase()+'">'+c.method+"</span></td></tr>",f+='<tr><td>URL:</td><td class="novice novice-postman url">'+c.url+"</td></tr>","params"===c.dataMode&&c.data&&c.data instanceof Array&&c.data.length>0){f+="<tr><td>Params:</td><td>";var g='<table class="novice novice-postman params">';c.data.forEach(function(a){g+="<tr><td>Key:</td><td>"+a.key+"</td></tr>",g+="<tr><td>Value:</td><td>"+a.type+"</td></tr>",g+="<tr><td>Type:</td><td>"+a.value+"</td></tr>"}),g+="</table>",f+=g,f+="</td></tr>"}else{var h=c.data;if(c.headers&&c.headers.toLowerCase().indexOf("content-type: application/json")!=-1){try{h=angular.isString(c.rawModeData)&&""!=c.rawModeData.trim()?c.rawModeData:h,h=angular.isArray(h)&&h.length>0||angular.isString(h)&&""!=h.trim()?'<pre class="novice novice-postman raw">'+i(angular.toJson(angular.fromJson(h),2))+"</pre>":"none"}catch(a){console.error("Unable to prettify JSON: "+a)}f+="<tr><td>Data:</td><td>"+h+"</td></tr>"}}return f+="</tbody></table>"};return s='<div class="novice novice-postman">',s+='<h1 class="title">'+f.name+"</h1>",g&&g.length>0?g.forEach(function(a){s+='<h2 id="'+l(a.name)+'" class="novice novice-postman folder">'+a.name+"</h2>";var b=a.name;a.order.forEach(function(a){var c=k(h,a);c&&(s+=j(c,b))})}):h.forEach(function(a){s+=j(a)}),s+="</div>",e?c.trustAsHtml(s):s}function o(a){if(!a&&t.length>0)return t;var b=a?a:angular.fromJson(r),c=b.folders,d=a?p(a):p();return c&&c.length>0&&(c.forEach(function(a){a.order.forEach(function(b){var c=k(d,b);c&&(angular.isArray(a.requests)||(a.requests=[]),a.requests.push(c))})}),a||(t=angular.copy(c))),c}function p(a){if(!a&&u.length>0)return u;var b=a?a:angular.fromJson(r),c=b.requests;return a||(u=angular.copy(c)),c}var q,r,s="",t=[],u=[];return{getJsonUrl:g,setCollection:h,getCollection:i,getHTMLDoc:j,getFolders:o,getRequests:p,getMarkdownConverter:d,getRequestWithId:k,toUnderscore:l,toUnderscoreConcat:m,fromUrl:f,buildHTMLDoc:n}}]),postman.directive("postmanCollection",["PostmanDoc","$compile","$http","$templateCache","$timeout","$anchorScroll","$sce",function(a,b,c,d,e,f,g){var h={url:"collectionUrl",template:"templateUrl",showdownjs:"mdToHtmlDescription",repeatFoldername:"repeatFoldername",noCache:"noCache"},i=angular.copy(a);return{restrict:"A",scope:{collectionUrl:"@collectionUrl",templateUrl:"@templateUrl",markdownDescription:"=mdToHtmlDescription",repeatFoldername:"=repeatFoldername",noCache:"=noCache"},link:function(a,j,k){var l=function(){e(function(){f()},5)},m=function(c){j.append(c),b(j.contents())(a),l()},n=function(){m(d.get(a.templateUrl))};if(a.postmanCollection==i.getJsonUrl()&&angular.isUndefined(a.templateUrl)&&""!=i.getHTMLDoc())return void m(i.getHTMLDoc(!1));var o=!1;angular.isUndefined(a.markdownDescription)?angular.isString(k[h.showdownjs])&&""===k[h.showdownjs]&&(o=!0):o=a.markdownDescription;var p=!1;angular.isUndefined(a.repeatFoldername)?angular.isString(k[h.repeatFoldername])&&""===k[h.repeatFoldername]&&(p=!0):p=a.repeatFoldername;var q=!1;angular.isUndefined(a.noCache)?angular.isString(k[h.noCache])&&""===k[h.noCache]&&(q=!0):q=a.noCache,i.fromUrl(a.collectionUrl).then(function(b){angular.isUndefined(a.templateUrl)?m(i.buildHTMLDoc({repeatFoldername:p,mdToHtmlDescription:o,safeHtml:!1})):(a.collection=i.getCollection(),a.folders=i.getFolders(),a.requests=i.getRequests(),a.showMe={},a.folders.forEach(function(b){a.showMe[b.name]=!1,b.uname=i.toUnderscore(b.name),b.requests.forEach(function(a){a.uname=i.toUnderscoreConcat(b.uname,a.name),o&&(a.htmlDescription=g.trustAsHtml(i.getMarkdownConverter().makeHtml(a.description)))})}),q?c.get(a.templateUrl).then(function(a){m(a.data)}):angular.isUndefined(d.get(a.templateUrl))?c.get(a.templateUrl).then(function(b){d.put(a.templateUrl,b.data),n()}):n())})}}}]),postman.directive("postmanFolders",["PostmanDoc","$compile","$http","$q","$templateCache","$timeout","$anchorScroll","$location",function(a,b,c,d,e,f,g,h){var i={url:"collectionUrl",ref:"ref"},j=angular.copy(a);return{restrict:"A",scope:{collectionUrl:"@collectionUrl",ref:"@ref"},link:function(a,e,f){var g,h=function(c){e.append(c),a.waitTillItsDone=!1,b(e.contents())(a),a.waitTillItsDone=!0},k=function(a,b){c.get(f[i.url]).then(function(b){g=angular.copy(b.data),a(b)},function(a){b(a)})};d(k,10).then(function(){var b=angular.fromJson(g),c=j.getFolders(b);if(c&&c.length>0){a.showMe={},c.forEach(function(b){a.showMe[b.name]=!1,b.uname=j.toUnderscore(b.name),b.requests.forEach(function(a){a.uname=j.toUnderscoreConcat(b.uname,a.name)})}),a.folders=c,a.toggleFolder=function(b){a.showMe[b]=!a.showMe[b]},a.getMethodPetName=function(a){var b=a;if(angular.isString(a))switch(a){case"DELETE":b="DEL";break;case"delete":b="del"}return b};var d='<div class="postman-collection-folders">';d+='<ul class="postman-folders" style="list-style-type: none; width: 100%;">',d+='<li class="postman-folder" ng-repeat="folder in folders" data-text="folder.name">',d+='<div ng-class="{\'open\': showMe[folder.name]}" data-ng-click="toggleFolder(folder.name)" title="{{folder.name}}" ',d+='style="cursor: pointer; width: 100%; display: block; float: none;">',d+="<i ng-class=\"showMe[folder.name] ? 'icon-folder-open' : 'icon-folder'\"></i> <span class=\"postman-folder-name\">{{folder.name}}</span>",d+="</div>",d+='<ul class="postman-requests" data-ng-show="showMe[folder.name]" style="list-style-type: none; width: 100%;">',d+='<li class="postman-request" ng-repeat="r in folder.requests">',d+='<div ng-class="r.method.toLowerCase()" class="method" style="display: block; float: none;"><span>{{getMethodPetName(r.method)}}</span></div>',d+='<div class="postman-request-name" style="display: block; float: none;">';var e=angular.isUndefined(a.ref)?"":a.ref;d+='<a data-ng-href="'+e+'#{{r.uname}}">{{r.name}}</a>',d+="</div>",d+="</li>",d+="</ul>",d+="</li></ul></div>",h(d)}})}}}]);